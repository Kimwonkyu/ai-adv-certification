# 📘 [학습 노트] 교재 5. RAG & Agent (검색 증강 생성 및 에이전트)

## 1. RAG 파이프라인의 고도화 (Advanced RAG)
단순한 검색-생성(Naive RAG)의 한계를 극복하기 위해 매 단계에서 정밀한 최적화가 필요합니다.

### ✂️ 전략적 청킹 (Chunking Strategy)
- **Recursive Character Chunking**: 문단, 문장, 단어 순으로 의미가 깨지지 않게 재귀적으로 분할합니다. (가장 널리 쓰임)
- **Semantic Chunking**: 임베딩 유사도를 분석하여 **"의미가 변하는 지점"**을 포착해 자릅니다.
- **Chunk Overlap**: 청크 간의 연결성을 위해 10~20% 정도 텍스트를 중복시킵니다.

### 🔍 검색 고도화 기술 (Search Optimization)
- **HyDE (Hypothetical Document Embedding)**: 질문을 바로 검색하지 않고 '가상의 정답'을 먼저 써보게 한 뒤, 그 글과 닮은 문서를 찾습니다. (질문과 문서 사이의 간극 제거)
- **Multi-Query Retrieval**: 질문을 3~5개로 확장하여 검색 확률을 높입니다.
- **Reranking**: 가벼운 모델로 100개를 찾은 뒤, 무거운 고성능 모델(Cross-encoder)로 상위 5개를 다시 정렬합니다. 가장 확실한 성능 향상 기법입니다.

---

## 2. 벡터 데이터베이스와 인덱싱 기술
수백만 개의 데이터 중 가장 유사한 것을 0.1초 만에 찾는 마법의 기반입니다.

### ⚡ 인덱싱 알고리즘
- **HNSW (Hierarchical Navigable Small World)**: 데이터를 여러 층의 그래프로 연결합니다. 상위 층에서 성기게 점프하여 하위 층의 정밀한 위치에 도달하는 방식으로, 속도와 정확도의 밸런스가 최고입니다.
- **IVF (Inverted File Index)**: 데이터를 클러스터링(군집화)하여 질문이 속한 군집만 뒤집니다. 메모리 효율이 좋습니다.
- **Flat Index**: 모든 데이터를 전수 조사합니다. 느리지만 정확도는 100%입니다.

---

## 3. 에이전트 설계 패턴 (Agentic Design Patterns)
로봇이 직접 사고하고 행동하듯, LLM이 시스템의 제어권을 갖는 구조입니다.

### 🔄 자가 성찰 및 보정 (Self-Reflection)
- **Self-RAG**: 생성된 답변이 문서에 근거하는지 스스로 채점하고, 부족하면 다시 검색하거나 수정합니다.
- **Corrective RAG (CRAG)**: 검색 결과의 품질이 낮으면 웹 검색을 수행하거나 답변을 거부하는 안전장치입니다.

### 📅 기획 및 실행 (Planning & Execution)
- **Plan-and-Solve**: 문제를 보자마자 행동하지 않고, 전체 실행 계획을 먼저 수립한 뒤 단계별로 수행합니다.
- **Multi-Agent Collaboration**: 협업 구조(예: 작가 에이전트 + 비평가 에이전트)를 통해 결과물의 품질을 반복해서 높입니다.

---

## 4. RAG 평가 지표 (Evaluation)
답변이 잘 나왔는지 수치로 측정하는 기준입니다. (RAGAS 프레임워크 기반)

1.  **Faithfulness (충실성)**: 답변의 내용이 검색된 문서에 실제로 있는가? (할루시네이션 체크)
2.  **Answer Relevancy (답변 관련성)**: 답변이 사용자의 질문에 직접적으로 대답하고 있는가?
3.  **Context Precision (검색 정밀도)**: 검색된 문서들 중 정답에 유용한 정보가 상위권에 잘 배치되었는가?