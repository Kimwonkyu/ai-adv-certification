# 📘 [학습 노트] 교재 5. RAG & Agent (Foundation to Ultimate Deep Dive)

이 교재는 외부 지식을 주입하여 할루시네이션을 해결하는 RAG 시스템의 기초부터, 스스로 사고하고 행동하는 자율 에이전트의 고급 아키텍처까지 720개 문항의 모든 지형을 다룹니다.

---

## 1. RAG (Retrieval Augmented Generation) 아키텍처
### 🏗 기본 파이프라인 (The 5 Steps)
1.  **Ingestion (적재)**: 데이터 로드 및 전처리.
2.  **Chunking (분할)**: `RecursiveCharacterTextSplitter` 등을 사용해 조각 분리. `chunk_size`와 `chunk_overlap`의 균형이 중요합니다.
3.  **Indexing (인덱싱)**: 임베딩 후 벡터 DB 저장.
4.  **Retrieval (검색)**: 질문과 의미적으로 유사한 조각 인출.
5.  **Generation (생성)**: 인출된 맥락(Context)을 합쳐 LLM이 최종 답변 생성.

---

## 2. 벡터 인덱싱과 초고속 검색 기술
### ⚡ HNSW (Hierarchical Navigable Small World)
데이터를 계층적 그래프로 연결하여 수백만 개의 데이터 중 가장 유사한 것을 $O(\log N)$ 수준의 속도로 찾아냅니다.
- **파라미터**:
    - **M**: 각 노드의 최대 연결 수. 클수록 정밀하지만 메모리를 많이 씁니다.
    - **ef_construction**: 인덱싱 시 탐색 범위. 높을수록 인덱스 품질이 좋아집니다.
- **IVF (Inverted File)**: 공간을 클러스터링하여 검색 범위를 물리적으로 제한합니다.

---

## 3. 고급 검색(Advanced Retrieval) 및 최적화
단순 검색의 한계를 넘는 고도화 전략입니다.

### 🚀 리랭킹 (Reranking)
- **Bi-Encoder**: 속도는 빠르지만 정밀도가 낮음.
- **Cross-Encoder**: 질문과 문서를 직접 어텐션하여 연산. 매우 정밀하지만 느림.
- **전략**: Bi-Encoder로 수백 개를 먼저 뽑고, Cross-Encoder로 상위 5개를 '리랭킹'하여 정확도를 극대화합니다.

### 🎭 검색 증강 기법
- **HyDE (Hypothetical Document Embeddings)**: 모델이 가상의 정답을 쓰고, 그 정답을 임베딩하여 실제 문서를 찾는 기술입니다. 질문과 정답 간의 의미적 거리를 좁힙니다.
- **Parent-Child (Small-to-Big)**: 검색은 작고 정밀한 조각(Child)으로 하고, 모델에게는 그 조각이 포함된 넓은 문택(Parent)을 전달합니다.

---

## 4. 자율 에이전트와 LangGraph
LLM이 단순한 생성기가 아닌, **의사결정자(Planner)**로 동작하는 시스템입니다.

### 🔄 ReAct와 자기 반성
- **ReAct 루프**: 생각 → 행동 → 관찰을 반복하며 목표를 추구합니다.
- **Self-Reflection (자기 반성)**: 답변을 낸 뒤 에이전트 스스로 오류를 검증하고 수정 노드로 다시 돌아가는 설계입니다.

### 📅 LangGraph: 상태 유지 그래프
- 에이전트의 작업 이력을 **State** 객체에 담아 유지합니다.
- **노드(Node)**와 **엣지(Edge)**를 통해 순환(Loop) 구조의 복잡한 비즈니스 로직을 구축합니다.

---

## 5. RAG 성능 평가와 메모리
### 📊 RAGAS 평가지표
RAG 시스템의 품질을 수치화하는 표준 프레임워크입니다.
- **Faithfulness (충실성)**: 답변이 문서에만 근거하는가?
- **Answer Relevancy (관련성)**: 답변이 질문 의도를 충족하는가?
- **Context Precision (정밀도)**: 검색 결과 상위에 정답이 잘 분포하는가?

### 📅 효율적 대화 기억
- **Window Memory**: 최근 맥락 위주 기억. 
- **Summary Memory**: 긴 대화를 압축 요약하여 토큰 사용량을 최적화합니다.

이상의 내용을 완벽히 이해하면 RAG와 에이전트 단원의 모든 고난도 문항을 해결할 수 있습니다.