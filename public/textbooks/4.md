# 📘 [학습 노트] 교재 4. 프롬프트 엔지니어링 (Foundation to Ultimate Deep Dive)

이 교재는 프롬프트의 기본 구성 요소부터 고차원 추론 유도, 자율형 에이전트 설계, 그리고 상용 수준의 보안 체계까지 720개 문항의 모든 기술적 기반을 다룹니다.

---

## 1. 프롬프트 엔지니어링의 정석 (Foundation)
### 🏗 프롬프트의 4대 구성 요소
1.  **Instruction (지시)**: 모델이 수행할 구체적인 작업(요약, 번역, 추론 등).
2.  **Context (맥락)**: 외부 지식이나 제약 조건을 포함하는 배경 지식.
3.  **Input Data (입력)**: 처리가 필요한 실제 텍스트.
4.  **Output Indicator (출력 형식)**: JSON, 표, 마크다운 등 원하는 형식을 명시.

### 🏷 구조화 및 구분자 (Delimiters)
- **Delimiters**: `###`, `---` 또는 XML 태그(`<context>`, `<example>`)를 사용하여 지시사항과 데이터를 엄격히 분리함으로써 지시 이행력을 높입니다.
- **Few-shot Prompting**: 예시(Shot)를 제공하여 모델의 답변 패턴을 제어합니다.

---

## 2. 심화 추론 유도 전략 (Advanced Logic)
### 🧠 논리적 사고의 유도
- **CoT (Chain-of-Thought)**: "Let's think step by step" 문구로 잠재적 추론 성능을 활성화합니다.
- **Few-shot CoT**: 정답뿐만 아니라 '추론 과정'을 예시로 제공하여 복잡한 수학/논리 문제의 정확도를 극대화합니다.
- **Self-Consistency (자기 일관성)**: 여러 개의 추론 경로를 생성하게 하여 다수결(Majority Vote)로 최종 답을 결정함으로써 개별 추론 오류를 상쇄합니다.
- **Least-to-Most**: 큰 문제를 작은 조각으로 먼저 분해하고 해결하는 순차적 접근법입니다.

---

## 3. 에이전트와 ReAct 프레임워크
에이전트는 LLM을 '사고 엔진'으로 사용하여 스스로 도구를 탐색하고 문제를 해결합니다.

### 🔄 ReAct 루프
- **Thought** (상태 분석 및 계획) → **Action** (도구 선택/함수 호출) → **Observation** (도구 결과 확인) → **Thought** (결과 바탕 수정 및 다음 단계).
- **Tool Calling (Function Calling)**: 모델은 도구 실행에 필요한 **인자(JSON)**를 생성하고, 시스템이 실제 실행 후 결과를 모델에게 '관찰값(Observation)'으로 전달하는 구조입니다.

---

## 4. 프롬프트 보안: 공격과 방어 (Security)
### ⚔️ 주요 공격 패턴
- **Prompt Injection**: 입력 데이터를 통해 시스템 프롬프트를 무력화하고 권한을 탈취하는 행위.
- **Jailbreaking**: 모델의 안전 가이드라인을 우회하여 금지된 정보를 생성하게 유도 (예: DAN 모드).
- **System Prompt Leaking**: 모델 내부의 기밀 지시사항이나 초기 정보를 빼내는 공격.

### 🛡 방어 전략
- **XML Delimiters**: 태그 내부에 데이터를 가두어 지시 영역과 데이터 영역의 경계를 강화합니다.
- **Post-instruction**: 사용자 입력 바로 뒤에 시스템 지시를 재반복하여 **Recency Bias**(최신 정보 우선성)를 활용한 방어를 수행합니다.

---

## 5. 프롬프트 프로그래밍과 자동화
### 🧪 DSPy: Programming, not Prompting
- 프롬프트를 수동 작성하는 대신, **Signatures**와 **Modules**로 정의하고 **Teleprompter**(최적화기)를 통해 모델 가중치 튜닝처럼 프롬프트를 자동 컴파일합니다.

### 🧬 LCEL (LangChain Expression Language)
- Pipe 연산자(`|`)를 통해 `Prompt | Model | Parser` 구조를 선언적으로 결합합니다.
- **`RunnableParallel`**: 서로 다른 도구나 검색 결과를 동시에 병렬 처리하며 취합합니다.
- **`with_fallbacks`**: 모델 장애 시 즉시 대체 모델로 전환하는 견고성을 제공합니다.

이상의 내용을 완벽히 이해하면 프롬프트 엔지니어링 단원을 마스터할 수 있습니다.