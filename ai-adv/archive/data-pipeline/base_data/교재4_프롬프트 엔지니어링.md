📘 [학습 노트] 교재 4. 프롬프트 엔지니어링 (LangChain & Agents)
1. 프롬프트 엔지니어링 핵심 개념
• 정의: 언어 모델(LLM)이 사용자가 원하는 답을 내놓도록 입력(맥락+지시)을 설계하는 기술입니다.
• 트렌드 변화: 과거에는 복잡한 스킬이었으나, 모델의 성능(Reasoning 능력)이 좋아지면서 **'단순화'**되고 있으며, 모든 직무의 기본 역량으로 변화하고 있습니다.
• 좋은 프롬프트의 4요소 (Persona-Task-Context-Format):
    1. Persona (역할): "너는 ~야"라고 역할을 부여합니다. (단, 최신 논문에 따르면 지식 회상보다는 답변 형식 통제에 더 유효합니다).
    2. Task (목표): 요약, 번역, 분류 등 구체적인 작업을 명시합니다.
    3. Context (맥락): 작업에 필요한 배경, 데이터, 제약 조건을 제공합니다 (Context Engineering의 핵심).
    4. Format (형식): 마크다운 표, JSON, 불릿 리스트 등 출력 형식을 지정합니다.
2. 프롬프트 구조화 및 심화 기법
• 구조화 (Structuring): #, ---, < > 등의 기호를 사용하여 Context, Question, Steps 등을 명확히 구분해 주면 모델이 집중해야 할 곳을 잘 파악합니다.
• Few-shot Prompting: 프롬프트 안에 입력-출력 예시를 제공하여 "이 패턴을 따라 하라"고 가르치는 방식입니다.
• CoT (Chain-of-Thought):
    ◦ "풀이 과정을 서술하라"고 하여 논리 추론을 유도합니다. 정답보다 중간 추론(Reasoning) 토큰을 많이 쓰게 하여 성능을 높입니다.
    ◦ Zero-shot CoT: 예시 없이 "Let's think step by step"이라는 문구만으로 CoT 효과를 냅니다.
• Step-Back Prompting: 바로 답을 구하지 않고, 문제 해결에 필요한 개념이나 구조를 먼저 뽑게 한 뒤 답변하게 하는 2단계 전략입니다.
• 팁: 지시사항(Instruction)은 영어로 줄 때 모델의 이해력과 토큰 효율이 높아지는 경향이 있습니다.
3. LangChain 구현 (LCEL & Pipeline)
• LCEL (LangChain Expression Language): PromptTemplate, LLM, Parser 등을 파이프 연산자(|)로 연결하여 체인을 구성하는 문법입니다.
    ◦ 기본 패턴: Prompt | LLM | OutputParser.
• 주요 컴포넌트:
    ◦ PromptTemplate: SystemMessage(역할), HumanMessage(질문) 등을 조합하여 템플릿을 만듭니다.
    ◦ OutputParser: StrOutputParser(문자열 반환), JsonOutputParser(JSON 객체 반환) 등이 사용됩니다.
    ◦ Runnable: RunnablePassthrough(입력 전달), RunnableParallel(병렬 실행) 등 체인 흐름을 제어합니다.
4. Tool Calling & Agents (에이전트)
• Tool Calling: LLM이 텍스트로 **함수 호출 스펙(JSON)**을 출력하면, 외부 시스템이 이를 실행(검색, 코드 실행 등)하고 결과를 다시 LLM에 넘기는 구조입니다.
• ReAct (Reasoning + Acting):
    ◦ 단순 작업이 아닌 복잡한 작업을 위해 **"생각(Thought) → 행동(Action) → 관찰(Observation)"**을 반복하는 프레임워크입니다.
• Agentic Work: 정해진 순서대로만 도는 'Workflow'와 달리, 판단이 필요한 지점에 LLM을 사용하여 유동적으로 경로를 선택하는 방식입니다.
• Multi-Agent: 검색 담당, 집필 담당, 코딩 담당 등 역할을 분리하여 토큰 낭비를 줄이고 성능을 높이는 구조입니다.
5. 실습 및 시험 대비 핵심 코드 패턴
• LLM 초기화: ChatOpenAI, model=..., temperature=... 설정.
• 문서 처리 (RAG):
    ◦ RecursiveCharacterTextSplitter: 문서를 청크 단위로 자를 때 사용 (chunk_size, chunk_overlap).
    ◦ MultiQueryRetriever: 사용자의 질문을 여러 관점으로 확장하여 검색 성능을 높임,.
• 도구(Tool) 정의: @tool 데코레이터를 사용하여 함수를 도구로 만들고, llm.bind_tools(tools)로 모델에 연결합니다,.