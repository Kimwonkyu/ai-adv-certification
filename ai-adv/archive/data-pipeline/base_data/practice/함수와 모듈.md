# [실습] 함수와 모듈

## 학습목표
- 함수를 정의하고 활용하여 코드를 재사용할 수 있다
- 매개변수와 반환값을 이해하고 다양한 함수를 작성할 수 있다
- 모듈을 생성하고 import하여 코드를 구조화할 수 있다
- 프로젝트의 기존 모듈들을 활용할 수 있다
## 함수 기초

함수는 코드의 재사용성을 높이고 프로그램을 모듈화하는 핵심 도구입니다.   

`def` 를 통해 정의합니다.
def plus(a,b):
    return a+b

print(plus(a=1,b=2))
plus
# 위치 인자: plus(1,2) 처럼 위치를 보고 전달
# 키워드 인자: plus(b=1, a=2) 처럼 이름을 지정해서 전달
a와 b를 매개변수(argument)라고 하며, 함수의 결과로 전달되는 값을 반환값(return)이라고 합니다.
함수의 가독성을 높이기 위해, 아래와 같이 타입 힌트나 독스트링을 추가하기도 합니다.
a="""나는
파이썬
공부중"""

print(a)
def plus(a:int,b:int) -> int:
    """a와 b를 더하는 함수"""
    return a+b

print(plus(35,64))
plus
help(plus)
## 다양한 함수 만들기   

def hello():
    """Hello, World를 반환하는 함수"""
    return "Hello, World!"

def greet(name):
    """인사말을 생성하는 함수"""
    return f"안녕하세요, {name}님!"

def analyze_text_length(text):
    """텍스트 길이를 분석하는 함수"""
    return {
        'length': len(text),
        'words': len(text.split()),
        'characters_no_spaces': len(text.replace(' ', ''))
    }

# 함수 호출
print(hello())
print(greet("김개발"))
print(analyze_text_length("Python은 훌륭한 프로그래밍 언어입니다"))
함수는 호출 자체에 return값이 존재하여, print와 구분됩니다.   
매개변수는 순서대로 넣거나, 키워드를 명시해서 전달합니다.
def power(a,b):
    return a**b
    # a의 b 거듭제곱

print(power(2,3))
print(power(b = 3,a = 2))
## 기본값과 args, kwargs

함수에는 기본값을 지정할 수 있습니다.   
# 기본값을 가진 매개변수
def clean_text(text, remove_punctuation=True, convert_lower=True):
    """텍스트를 정리하는 함수

    Args:
        text (str): 정리할 텍스트
        remove_punctuation (bool): 구두점 제거 여부
        convert_lower (bool): 소문자 변환 여부
    
    Returns:
        str: 정리된 텍스트
    """
    result = text.strip()
    
    if convert_lower:
        result = result.lower()
    
    if remove_punctuation:
        punctuation = '.,!?;:'
        for p in punctuation:
            result = result.replace(p, '')
    
    return result

# 다양한 방식으로 함수 호출
sample_text = "  안녕하세요! Python을 배우는 중입니다.  "

print(f"기본 정리: '{clean_text(sample_text)}'")
print(f"구두점만 제거: '{clean_text(sample_text, convert_lower=False)}'")
print(f"소문자만 변환: '{clean_text(sample_text, remove_punctuation=False)}'")
print(f"아무것도 안 하기: '{clean_text(sample_text, remove_punctuation=False, convert_lower=False)}'")
*args는 개수가 정해지지 않은 인자를 하나의 튜플로 받을 수 있습니다.
# 가변 인수와 키워드 인수
def combine_texts(*args, separator=' '):
    """여러 텍스트를 결합하는 함수
    
    Args:
        *arg: 결합할 텍스트들 (가변 인수)
        separator: 구분자
    
    Returns:
        str: 결합된 텍스트
    """
    text_list = []
    for text in args:
        text_list.append(str(text))
    return separator.join(text_list)

# 가변 인수 사용
print(combine_texts("Python", "Java", "JavaScript", separator=" | "))
print(combine_texts("첫 번째", "두 번째", "세 번째", "네 번째", '다섯 번째'))


**kwargs는 딕셔너리 방식으로 가변 인자의 값을 받아오는 방식입니다.    
Dict 방식이므로 키워드가 필요합니다.
def process_documents(**kwargs):
    """문서 처리 옵션을 출력하는 함수
    
    Args:
        **kwargs: 키워드 인수들
    """
    print("문서 처리 옵션:")
    for key, value in kwargs.items():
        print(f"  {key}: {value}")
# 키워드 인수 사용
process_documents(
    language='korean',
    encoding='utf-8',
    max_length=1000,
    clean_text=True
)
다음 예시는 args와 kwargs를 모두 사용하는 함수입니다.
def make_sentence(prefix="안녕하세요", *args, **kwargs):
    """
    Args:
        prefix (str): 문장 앞에 붙는 기본 인사말
        *args: 문장에 추가할 단어들
        **kwargs: 키워드로 추가할 정보(예: name="홍길동")
    Returns:
        str: 완성된 문장
    """
    sentence = prefix +' (여기까지 prefix) '
    if args:
        sentence += " "
        for i, arg in enumerate(args):
            # enumerate: index와 값을 함께 반복
            if i > 0:
                sentence += " "
            sentence += str(arg)
            
    sentence += " (여기까지 args) "

    if kwargs:
        info_list = []
        for k, v in kwargs.items():
            info_list.append(f"{k}={v}")
        info = ", ".join(info_list)
        sentence += f" ({info})"
    return sentence

# 사용 예시
print(make_sentence())
print(make_sentence("반갑습니다", "여러분!", "오늘은", "파이썬", "수업입니다", suffix='bye'))
print(make_sentence("환영합니다", '---', name="홍길동", age=25))


## 함수 호출의 언패킹(Unpacking)
def multiply(x, y, z):
    return x * y * z

nums = [2, 3, 4]
print(multiply(*nums))  # 24

params = {"x": 2, "y": 3, "z": 4}
print(multiply(**params))  # 24

## 함수 호출 심화   

함수를 반환값으로 사용할 수 있습니다.
def create_text_filter(keywords):
    """특정 키워드로 필터링하는 함수를 생성하는 함수
    
    Args:
        keywords (list): 필터링할 키워드 목록
    
    Returns:
        function: 필터링 함수
    """
    def filter_function(texts):
        filtered = []
        for text in texts:
            text_lower = text.lower()
            found = False
            for keyword in keywords:
                if keyword.lower() in text_lower:
                    found = True
                    break
            if found:
                filtered.append(text)
        return filtered
    
    return filter_function

# 특화된 필터 함수들 생성
tech_filter = create_text_filter(['python', 'java', 'ai', '프로그래밍'])
business_filter = create_text_filter(['경영', '매출', '투자', '마케팅'])

documents = [
    "Python 프로그래밍 기초",
    "효과적인 마케팅 전략",
    "Java 웹 개발 가이드",
    "투자 포트폴리오 구성",
    "AI와 머신러닝의 미래"
]

print("기술 관련 문서:")
for doc in tech_filter(documents):
    print(f"  - {doc}")

print("\n비즈니스 관련 문서:")
for doc in business_filter(documents):
    print(f"  - {doc}")
## 람다 함수와 정렬 함수

별도의 정의 없이도, 간단하게 사용할 수 있는 함수도 있습니다.
# def func(x):
#     return x**2
# func(3)

# 람다 함수 (익명 함수)
(lambda x: x**2)(3)
words = ['python', 'java', 'javascript', 'go', 'rust']

sorted_words = sorted(words)
# sorted: 기본 정렬 함수
sorted_words

words = ['python', 'java', 'javascript', 'go', 'rust']
word_stats = [
    {'word': 'python', 'frequency': 45, 'length': 6},
    {'word': 'java', 'frequency': 23, 'length': 4},
    {'word': 'javascript', 'frequency': 18, 'length': 10},
    {'word': 'go', 'frequency': 12, 'length': 2},
    {'word': 'rust', 'frequency': 8, 'length': 4}
]

# 길이순 정렬
sorted_by_length = sorted(words, key=lambda x: len(x))
sorted_by_freq = sorted(word_stats, key = lambda x: x['frequency'])
# key에 등록된 함수의 반환값을 기준으로 정렬

print(f"길이순 정렬: {sorted_by_length}")

print(sorted_by_freq)
## 이전 실습의 함수 다시 보기   

각 함수의 argument와 return 값을 고려하여, 아래 함수를 다시 실행해 봅시다.
def add_keywords(keyword_list, new_keywords):
    """키워드 리스트에 새 키워드 추가"""
    if isinstance(new_keywords, str):
        new_keywords = [new_keywords]
    keyword_list.extend(new_keywords)
    return keyword_list

def contains_keyword(text, keywords, case_sensitive=False):
    """텍스트에 키워드가 포함되어 있는지 확인"""
    if not case_sensitive:
        text = text.lower()
        lowered_keywords = []
        for k in keywords:
            lowered_keywords.append(k.lower())
        keywords = lowered_keywords
    found_keywords = []
    for keyword in keywords:
        if keyword in text:
            found_keywords.append(keyword)
    return found_keywords

def filter_texts(texts, keywords, mode='include', case_sensitive=False, stats=None):
    """텍스트 목록을 키워드로 필터링

    Args:
        texts: 텍스트 목록
        keywords: 키워드 리스트
        mode: 'include' (키워드 포함된 것만), 'exclude' (키워드 제외)
        case_sensitive: 대소문자 구분 여부
        stats: 통계 딕셔너리 (선택)
    """
    if stats is None:
        stats = {'total_processed': 0, 'matched': 0, 'filtered': 0}
    filtered = []
    for text in texts:
        stats['total_processed'] += 1
        found = contains_keyword(text, keywords, case_sensitive)
        if found:
            stats['matched'] += 1
            if mode == 'include':
                filtered.append({
                    'text': text,
                    'matched_keywords': found
                })
                stats['filtered'] += 1
        else:
            if mode == 'exclude':
                filtered.append({
                    'text': text,
                    'matched_keywords': []
                })
                stats['filtered'] += 1
    return filtered, stats

# 키워드 리스트 정의
keywords = ['AI', '머신러닝', '딥러닝', '데이터', '파이썬']

# 대소문자 구분 없이 키워드 저장
case_sensitive = False
if not case_sensitive:
    keywords_lower = []
    for k in keywords:
        keywords_lower.append(k.lower())
else:
    keywords_lower = keywords

print(f"키워드: {keywords}")

# 샘플 데이터로 테스트
sample_documents = [
    "Python으로 데이터 분석을 시작해보세요",
    "자바스크립트 웹 개발 가이드",
    "머신러닝과 AI의 미래",
    "데이터베이스 설계 원칙",
    "딥러닝을 이용한 이미지 인식",
    "네트워크 보안 기초",
    "파이썬 데이터 시각화 라이브러리",
    "클라우드 컴퓨팅 서비스 비교",
    "AI 윤리와 책임",
    "블록체인 기술 동향"
]

# 통계 딕셔너리 초기화
stats = {'total_processed': 0, 'matched': 0, 'filtered': 0}

# 기술 관련 문서만 필터링
filtered_docs, stats = filter_texts(sample_documents, keywords, mode='include', case_sensitive=case_sensitive, stats=stats)

print("=== 기술 키워드가 포함된 문서 ===")
for i, doc in enumerate(filtered_docs, 1):
    print(f"{i}. {doc['text']}")
    print(f"   매칭된 키워드: {', '.join(doc['matched_keywords'])}\n")

print(f"=== 필터링 통계 ===")
for key, value in stats.items():
    print(f"{key}: {value}")

## 라이브러리, 모듈, 패키지

구성한 함수는 모듈화하여 다른 코드에서도 사용할 수 있습니다.

코드를 재사용 가능한 모듈로 구성하는 방법을 배워보겠습니다.
### 1. import

import는 외부 라이브러리에서 기능을 가져오는 방식입니다.
import os
import json
import re
# 정규 표현식 라이브러리

from datetime import datetime

# datetime 모듈에서 datetime.datetime를 가져옵니다.

import random

print(random.randint(1, 100))
# 1~100 사이의 랜덤 정수 생성

print(datetime.now())
# 현재 시간 출력

print(re.findall(r'\b\d+(?:\.\d+)?\b', '어제의 종합주가지수는 3395.54 입니다.'))
# 정규표현식을 이용한 숫자 추출
# 현재 시간을 이용한 파일명 생성
def generate_filename(prefix="output", extension="txt"):
    """타임스탬프를 포함한 파일명 생성"""
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    return f"{prefix}_{timestamp}.{extension}"

# 정규표현식을 이용한 텍스트 처리
def extract_emails(text):
    """텍스트에서 이메일 주소 추출"""
    email_pattern = r'\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b'
    # 이메일 패턴 정의(정규표현식)
    
    return re.findall(email_pattern, text)

def extract_korean_words(text):
    """한글 단어만 추출"""
    korean_pattern = r'[가-힣]+'
    return re.findall(korean_pattern, text)

# 테스트
print(f"생성된 파일명: {generate_filename('analysis', 'json')}")

sample_text = "연락처: hong@company.com, kim.dev@gmail.com, Python과 데이터분석을 배우세요!"
emails = extract_emails(sample_text)
korean_words = extract_korean_words(sample_text)

print(f"추출된 이메일: {emails}")
print(f"한글 단어: {korean_words}")
위에서 만든 3개의 함수를 별도의 파일로 저장하고, 불러와 보겠습니다.   

utils.py를 만들고, import 셀과 함수 선언 코드 셀의 내용을 복사 붙여넣기하세요.   
이후 아래의 코드를 실행하세요.
import utils

# utils.py에 정의된 함수 사용 예시
filename = utils.generate_filename("result", "txt")
print(f"생성된 파일명: {filename}")

sample = "문의: lee@naver.com, park@daum.net, 파이썬과 인공지능을 공부하세요!"
emails = utils.extract_emails(sample)
korean_words = utils.extract_korean_words(sample)

print(f"이메일: {emails}")
print(f"한글 단어: {korean_words}")
%%writefile을 통해서도 구현할 수 있습니다.
%%writefile temp_text_utils.py
# temp_text_utils에 아래 코드 전체를 저장
# 모듈 레벨 변수
DEFAULT_ENCODING = 'utf-8'
VERSION = '1.0.0'

def count_syllables_korean(text):
    """한글 텍스트의 음절 수 계산"""
    import re
    # [가-힣] : 한글 완성형 음절(가~힣)에 해당하는 모든 문자 하나하나를 찾는 정규표현식 패턴
    korean_syllables = re.findall(r'[가-힣]', text)
    return len(korean_syllables)

def extract_numbers(text):
    """텍스트에서 숫자 추출"""
    import re  
    numbers = re.findall(r'\b\d+(?:\.\d+)?\b', text)
    result = []
    for num in numbers:
        if '.' in num:
            result.append(float(num))
        else:
            result.append(int(num))
    return result

def text_summary(text):
    """텍스트 요약 정보"""
    return {
        'length': len(text),
        'words': len(text.split()),
        'lines': len(text.split('\n')),
        'korean_syllables': count_syllables_korean(text),
        'numbers': extract_numbers(text)
    }

import temp_text_utils

test_text = "Python에서 데이터분석을 위한 라이브러리들을 학습합니다. 총 24개의 예제가 있습니다."

summary = temp_text_utils.text_summary(test_text)
print(f"\n모듈 사용 결과:")
print(f"  모듈 버전: {temp_text_utils.VERSION}")
print(f"  텍스트 요약: {summary}")